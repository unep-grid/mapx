## Changelog

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.113-beta' target='_blank'>1.6.113-beta</a>
  - Bug fixes
      - SDK : polyfill for <element>.contains method seems fail. Replaced with querySelector. Updated module list in app and sdk

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.112-beta' target='_blank'>1.6.112-beta</a>

  - Bug fixes 
      - APP :
        - Download raster -> wrong file type
        - Zoom to wms raster 
        - Filter by missing value (legend + popup) did not work
        - Popup : value 0 produced "missing value" message
        - First style of a new view : failed to detect attribute type
        - Buttons 'find extent', 'zoom to displayed features', 'show attribute table' was visible event for new vt view without source
        - JSON schema based form : diff message was shown even when no diff between locally saved data and data from db, if the timestamp was not the same. 
        - Dynamic layer list was not invalidated after uploading a new source or creating a new source using the overlap tool
        - Default opacity set to 0.7 for rules and null rule.
  - Improvement
      - SDK
        - Better README.md
       
- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.111-beta' target='_blank'>1.6.111-beta</a>

  - New features
      - APP
        - loadHighcharts / dashboard : added `exporting` and `export` data modules for highcharts
        - Style rule parser :
           - Added option to handle upper bound inside intervals. Both option and logic are supported now.
           - Partial refactoring: reduce code size, use async / await instead of chaining promises
  - Bug fixes
      - SDK
         - Issue with dependencies strangely not included in build. Need maybe further investigation
      - APP 
        - Excluded remaining swp file from precaching, which caused an error in console
        - Issue with path construction for the download file link in download modal
        - Source summary:  In case of error, return default and consol.warn instead of blocking. It could be expected in some cases and MapX should work without it
        - View GeoJSON: added back 'zoom to visible features' with fallback to 'zoom to extent'
        - Dashboard: added template value in script parsing rejection message

      - API
        - Source summary : allow spaces in attribute names
        - Invalidate tile cache if the source, the mask or the attributes requested change
  - Internal 
      - Ignore module dist folder

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.110-beta' target='_blank'>1.6.110-beta</a>
  - Bug fixes
      - API
        - Source summary, variable binning : solved an issue with max upper class, wrong binning when using integers, minor changes
      - APP
       - View 'auto style': Added a validation to test for duplicated rules. Could occurs when using quantile and a skewed distribution.
       - Service worker : precache list included .DS_Store file, but ignored by git and dockerfile. Produced 404 errors. Solved by modifying the regex in the webpack prod file.

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.109-beta' target='_blank'>1.6.109-beta</a>

  - Improvement
      - APP
        - Auto style editor : binning method have translated label
        - Vector view edit : a button to request source summary has been reactivated with the new stat summary overview
  - Bug fixes 
      - APP
        - Source summary. 
          - Total count did not match class count. 
          - Default and validation in APP did not match validation in server resulting in a number of class by default in UI,  if it was not valid server side.

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.108-beta' target='_blank'>1.6.108-beta</a>

  - New feature
      - APP 
        - Automatic style creator based on stats produced by the API (experimental)
        - New color picker : palettes are handled by the automatic style creator
  - Internal
     - APP: eslint step before any build, reorganising dot files.

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.107-beta' target='_blank'>1.6.107-beta</a>

  - New feature
      - APP : new method to ease fetching data through MapX mirror.
  - Improvement
      - API : simplify mirror method, copy back the response headers. 
      - APP, WMS interaction : exception as image; added busy interface when waiting.
  - Bug fixes
      - APP, WMS request: solved issue occuring with with empty styles in getMap request.
      - APP: Solved internal bug occuring when a new view without sources was saved.
      - APP, error manager : Error message not correctly displayed when extracting promise error message.

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.106-beta' target='_blank'>1.6.106-beta</a>

   - New features
       - API: Source summary can now return automatic binning for a continuous variable. Method implemented : jenks, equal_interval, heads_tails, quantile. e.g. `idSource=<id of the source >&idAttr=<variable name>&binsMethod=<jenks | equal_interval | heads_tails | quantile>&binsNumber=< integer >0 & <= 100>`
- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.105-beta' target='_blank'>1.6.105-beta</a>
    - Internal
       - API : remove token based restriction on route `/get/mirror` as it prevented usage from static site.

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.104-beta' target='_blank'>1.6.104-beta</a>

    - Improvement
       - APP, SDK : Added a test to control that the worker code match the manager version. An error is reported within the  messaging system if there is a mismatch. e.g. `mapx.on('message', (m)=>m.level=='error'?console.error(m.text):console.log('not an error'))`
    - Bug fixes
       - API : tile cache was not invalidated properly after the view's attributes list modification
    - Internal 
       - APP, ViewsFilter : all toggles are now called checkboxes.
       - APP, SDK : ( PR #564 ) tests can be launched by group, via a parameter in the URL.

- <a href='https://github.com/unep-grid/map-x-mgl/tree/1.6.103-beta' target='_blank'>1.6.103-beta</a>
    - New feature
       - SDK : Set/Get views filter. The view list can be managed from new method in the SDK. See issue #576 for details.

- 1.6.4 - 1.6.102 
    
    - Note: Changelog will be completed at that point. See commit messages for details.

- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.6.4-beta">1.6.4-beta</a>

    - New feature
       - New view integrated filter system : search using text with basic regex parsing, tags, activated views. Tags order reacts to language change. Two mode are available: union and intersection. Views count is more accurate and match all kinds of filters.
       - Views list : views can be repositioned with a wide range of options : date, title, drag and drop, relative position. A history of changes is kept. The order can be saved. Nessted groups can be created. Groups can be created, deleted, edited. All options are available with a right click in the list that produce a contextual menu. Content change according to click location. 
    - Improvement
      - APP
       - Internal unified event and listener management
       - Code refactoring : code rewrite using more strict structure, transfer method in dedicated modules (work in progress)
       - Remove direct access to an attribute table from a view if "allow download" in the source settings is not set 
       - Minimize button in modal window
       - Set file size limit for upload   
    - Bug fixes
      - APP 
        - In select box, drop-down menu always visible.
        - Story autostart has been reimplemented
        - Story map slides effect
        - The project spatial parameters are not reset on the map after a save
        - Various fixes
    - Breaking changes
      - API
        - We do not use connection pool : pooling should be done by a sensible pooling system, like pg_pool.
        - Instead of using OGR to transfer spatial data to the DB, a first step with "PGDump" is made, then the result is piped through psql.

- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.54">1.5.54</a>
    - Improvement 
      - APP 
        - Added new contact field in project's role settings 
      - APP/API
        - Added text version of html email messages
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.53">1.5.53</a>
    - New feature
      - APP 
        - New 'root mode' that allows platform administrators to switch user in order to solve issues.
    - Improvement
      - APP
        - Login messages for single use passwords or tokens are sent using an html template instead of raw text.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.52">1.5.52</a>
    - Improvement
      - APP 
        - Added options in projects to enable or not the join buttons to request membership see issue #251; 
    - Bug fixes
      - APP
        -  Fixes a bug where a guest user could see the join buttons
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.51">1.5.51</a>
    - Improvement
      - APP 
        -  Cleaned configuration files
        -  Added email configuration for setting default emails : bot, admin, guest.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.50">1.5.50</a>
    - Improvement 
      - APP Added logic to remove service worker and cache if there is not enough storage space in the browser. See issue #441.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.48">1.5.48</a>
    - Improvement
      - API
        - Added exposed header : content-length;
        - Set zip encoding as an option in sendJSON
      - APP
        - Attribute table modal: remove buttons if no data.
        - Jump to location at project change instead of fly to position;
        - Better performance and refactoring of the project list renderer;
        - Progress Radial : added animation frame support;
        - Merge pull request #435 from antobenve/master : style instead of styles in WMS request
        - Added diaf score / summary in metadata window in addition to the full diaf table; added link to raster metadata; Remove the homepage link to source title: use distinct homepage link and list of download/source link; should solve feature requests from #423
        - Added progress bar support in attributes table
    - Bug fixes
      - App
        - Solve issue where validation message did not work : login window, new view name, new project name, etc..
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.47">1.5.47</a>
    - Improvement
      - APP
        - Map Composer : new feature : change font size of current item; better resolution handling; various fixes;
        - Share manager : add auto start option for story map
        - Dashboard : add an option to ignore or not events that return no data or an empty array. Added callback arguments in widgets; Solved issues with dashboard modal window title;
        
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.46">1.5.46</a>
    - Improvement
      - APP
        - Map Composer : removed dependencies on medium-editor and interactjs use custom ones; Added new features to set page size, units and other settings.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.45">1.5.45</a>
    - New feature
      - APP
        - Each view based on a vector source have now a button to display the full attribute table of the source. There is a filtering system by attribute that will also filter the displayed elements on the map. The table can be exported as CSV.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.44">1.5.44</a>
    - New feature
      - APP
        - Map composer - early version. A module to compose a map based on currently visible views
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.43">1.5.43</a>
    - Bug fixes 
      - APP
        - Solved issue with secondary attributes that were unselected during view edit.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.42">1.5.42</a>
    - Improvement
      - APP
        - Added support for languages in forms validation + french translation
        - Allow GeoJSON view direct download
        - Full rebuild of modals
        - Added support for languages in color picker
        - Added support for languages in recovery system
        - Minor translation changes. See #327.

- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.41">1.5.41</a>    
    - Improvement
      - APP
        - Story map :
          - Editor translation in french
          - Full rebuilt UI renderer
          - Added tips section in editor
        - Style editor : support for style size by zoom ( point and lines )
      - APP/API
        - View metadata : faster, available using api, UI built client side.
        - Added support for SRS assignation for data upload should add support for DXF/CSV. See #413; 
        - Improved EPSG search module;
        - Removed _mx_valid column from attributes fields and schema, as requested in #410
    - Bug fixes
      - APP
        - Story map : fix issue with external view as object instead of the expected view id string.
        - #410 : 
          - Removed _mx_valid column from list attributes fields and schema in forms
          - Fix legend filter not cumulative
    - Other :
      - APP
        - Removed loop optimisation. Loop optimizer have some issue when used in expression : the for loop was rebuilt outside scope;


- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.40.2">1.5.40.2</a>
    - Improvement
      - APP/API
        - Starting code style validation using JSHint. See .jshintrc. This implies majors changes in all js, css, and html files. This will be a long incremential work.
      - APP
        - Dashboard button activate when there are widgets.
        - In draw mode, popup does not show anymore if clicked on a feature
    - Bug fixes
        - API
        - Issue with geometry validation: auto-correction / validation did not work due to typos and logic Separate json and xml utilities

- <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.40.1">1.5.40.1</a>

    - Bug fixes 
      - API 
        - Fix bug where overlap analysis produced an auto-correction 
    - New features 
      - APP
        - Draw tool. `mapbox-gl-draw`
        - Geojson view creation using resulting draw 

 - <a href="https://github.com/unep-grid/map-x-mgl/tree/1.5.40">1.5.40</a>

    - Improvement 
      - APP 
        - Unified methods to retrieve click based map query on MapX layers : one function is used for dashboard events, map popup event, for both raster and vector source 
    - New features 
      - APP 
         - Raster views and custom code views have a dashboard functionality 
         - The click event in dashboard is usable for querying raster sources.

- <a href="https://github.com/unep-grid/map-x-mgl/tree/bbb37f">1.5.30</a>
    - Improvement
      - API/APP
          - Create new source based on overlap analysis
          - Download authentication. Now, same method as upload and overlap, with encrypted token
          - Download and clip : validate beforehand instead of failing in ogr2ogr step
          - Color in logs
          - Download, uploads and overlap have an unified interface for logs
          - Logs autoscroll
          - Version in tools panel solved : index.html was not re-build when webpack build prod version
    - Bug fixes
          - Broken uploader
       
- <a href="https://github.com/unep-grid/map-x-mgl/tree/ce3d0d54c1">1.5.29</a>
    - Iprovement
      - APP
          - Batch screenshot creation
          - New layout for view description, should solve a bug in windows Chrome browser where legends were not rendered
          - Set application update as optional. At least, warn the user that an update is ready.
          - Better modal window
    - New features
      - API
          - Implemented precise area calculation of overlap between countries and selected layers.
          
- <a href="https://github.com/unep-grid/map-x-mgl/tree/5515f88ef71">1.5.27</a>
    - Improvement
      - APP
          - Better loading screen : higher z-index, block events when the app is busy, smooth transition back, when the loading is done
          - Support for attribut alias in metadata
          - Better tool for download pdf : cleaner, faster. 
          - Trigger layer list  when an upload is done
          - Meta data editor, now in two steps: no more wait on the first data editor to load
          - Layer management: hide linked source summary
          - Less waiting time when loading project list
          - Code refactoring : regroup reactive function by type. Should solve actions duplicate.
    - New feature
      - API 
          - Method to get source metadata : "/get/souce/metadata:id"
- <a href="https://github.com/unep-grid/map-x-mgl/tree/11f89e4fea966169df9089d5c2ca15b301a575c5" target="_blank">1.5.26</a>
    - Improvement
      - APP
          - Update build process : use smaller chunks – issue with babel loader that produced huge chunks –; add promise polyfill, manually add manifest, minor changes;
      - API
          - Added new numeric parser to avoid bug in tiles where numeric was converted to string. This is related to style on numeric columns not correctly handled.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/bba8abc110f67d7654a509099cc85a3f683b244e" target="_blank">1.5.25</a>
    - Improvement 
      - APP 
          - Upgrade all dependencies, fixes related issues
          - Upgrade build system to Webpack 4
          - Solve issues with translation rendering in metadata viewer 
- <a href="https://github.com/unep-grid/map-x-mgl/tree/20067870e8cbaf11af66ddfba39f2612c439236c" target="_blank">1.5.24</a>
    - Improvement
      - APP : Testing session reconnection
      - APP : Instant estimate of overlap area
    - Bug fixing
      - APP : Overlap function in PixOp had issue with lines: the first coordinate of each line could have been omited.
      - APP : Changed the regular expression that "validate" email to a more strict one. 
- <a href="https://github.com/unep-grid/map-x-mgl/tree/144d2a37bd30955c4ad8a3b5081db25b18625d97" target="_blank">1.5.23</a>
    - Improvement
      - APP : save and update query parameters: project, language, lat, lng, zoom. 
    - Bug fixing
     - APP : Overlaps using pixop, numbers of layers to take in account did not unterstood "All layers". Should be ok
- <a href="https://github.com/unep-grid/map-x-mgl/tree/9557502329e34b821f6c4df0e9aaf3bb1f12edaa" target="_blank">1.5.22</a>
    - Improvement
      - APP/API Let the user provide a projection system for download
      - APP : add basic option for highlight overlap tools
      - APP/API : new environment variable to store tokens and allowed user id as creator
      - APP : Add public view from public project in story maps available views
- <a href="https://github.com/unep-grid/map-x-mgl/tree/8ebeae87833c8447041669db0a45c6d77625319f" target="_blank">1.5.21</a>
   - Improvement
      - API : Set pre-simplification only for zoom > 10 in postgres. 
      - APP : Added new environment variables for handling mapbox token and allowed project creators
- <a href="https://github.com/unep-grid/map-x-mgl/tree/61b5592bdf2de9afb14a4bf1cf1713571e0ca0b1" target="_blank">1.5.20</a>
   - Improvement
      - Added an experimental tool to highlight potential overlaps between vector layers
    - Bug fixing
      - Story map bullets werent removed due to a DOM issue 
      - Confidentiality issue : a publisher with edit access to a story map editor was able to list and use views from a private projects to which she had no access. This could still occurs if the view is purposely shared or imported as public view to another non-private project.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/bc81b623ce09bc1359857c5e9cce00f8a1c24854" target="_blank">1.5.19</a>
   - Improvement
      - Added support for quering wms based raster source layer
- <a href="https://github.com/unep-grid/map-x-mgl/tree/caaee2e9be52711da3c0805da215140653661d59" target="_blank">1.5.18</a>
   - Improvement 
      - Added support for download sources as CSV #212
      - Added projection data when downloading geospatial files #322
   - Bug fixing
      - Solved issue when images in legend where broken into multiple columns #324
   - Rollback
      - Remove privilege to create new project for everyone. Only selected user can create new project.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/d02a7ce3c3985fe8629efb324014871881b70c9a" target="_blank">1.5.17</a>
   - Improvement
       - Add current view count in filters by category
       - Style minor change in filter by labels and filter by attributes 
- <a href="https://github.com/unep-grid/map-x-mgl/tree/7362a8457e76cea32dca9fb1367edfe78660736f" target="_blank">1.5.16</a>
   - Improvement 
       - Modal Added four preset button for modal panel, added an option to resize panel horizontally.
       - Added autoprefixer for CSS in webpack config
   - Bug fixing
       - Dashboard modules could be ignored after a view edition. In case of only one module, the script automatically converted the value in a JSON string, and the dashboard was expecting an array. The `module` key in the `view.data.dashboard` can now be a string or an array. Or empty.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/3c8d973fbb55a7c5d4fb57fb32b3eda2700c24ad" target="_blank">1.5.15</a>
   - Added translation support in filter views list by tags
   - Filter views by tags : use `AND` operator between filter types and `OR` within filter types. 
- <a href="https://github.com/unep-grid/map-x-mgl/tree/c1e7616df923d9860264d79cc461dfa5b6d657d5" target="_blank">1.5.14</a>
   - Removed bug where (empty) private project could be seen when pressing a shared view's "home" button
   - Added support for spanish. Thanks @GianlucaGygax !
   - Updated service workers strategy. Using no-cache in traefik should solve issue where old cache were kept.
   - Modification on entry files for webpack to enable a viewer only mode for the app.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/775e37f9d58f6f51df94bf890a19753f64d43e95" target="_blank">1.5.13</a>
   - Removed a bug where a dashboard was not removed if no source layer where used
   - Use pointer events instead of mouse event
   - Added a 'minimize' button in modal windows
   - Removed resize corner in modal windows – ( it's not widely used and it produced a bug with flexbox )
- <a href="https://github.com/unep-grid/map-x-mgl/tree/0e8c7feae41290071b2fb728cd1ad369974868c0" target="_blank">1.5.12</a>
   - Solved an issue in view button when a zoom was applied in the browser: the nested circle was not well aligned producing a weird effect. Using SVG, the problem as been solved. 
   - Update dependencies, see `app/package.json`
   - Changed the service worker generator to `workbox-webpack-plugin` 
   - Solved #277 where removal of a project did not remove releated views that does not had sources (raster, story, etc). 
- <a href="https://github.com/unep-grid/map-x-mgl/tree/d509c639fc1be78e81405a978a63db1ff5b1d190" target="_blank">1.5.11</a>
   - Solved #276
   - Solved #274
   - Added a function to unregister service worker 
- <a href="https://github.com/unep-grid/map-x-mgl/tree/4c36b899fd5887b21536703eed61ba4c22ebc07f" target="_blank">1.5.10</a>
   - New radial progress svg constructor
   - Direct local storage for views object, in addition to browser cache and service worker cache. Faster. 
   - Bug fixes : label too long in map data properties query popup. Display the full thing on hover.
   - Code cleaning
- <a href="https://github.com/unep-grid/map-x-mgl/tree/d60a48cb841753e2578473a521b8d757cec6d5ff" target="_blank">1.5.9</a>
   - Improvement of road style : added more than 30 layers extracted and modified from style "Lè Shine" (https://frama.link/leshine),
   - Integrated simplified colors setting for roads, road border and building in style editor.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/36fdfebac77231db028b358dd173e4ab9fd4ed7a" target="_blank">1.5.8</a>
   - Solved #272 : the built date was wrong in the encrypted mail validation.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/dfc4013b8b69f572794bc3d691eec366289809af" target="_blank">1.5.7</a>
   - Add service worker to cache assets and tiles,
   - Migrate language dict file to JSON, instead of csv, to be able to merge pull requests more easily,
   - Minor changes.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/50b05b59d95b46ea3835b15d6ced9fc161d50455" target="_blank">1.5.6</a> 
   - Updated version of R,
   - Added api upload for geojson stored client side,
   - Minor changes.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/032f969f49e167aeb8af70dcc899a6fb8f34b169" target="_blank">1.5.5</a>
   - Added query parameter support to filter max role for view fetching : `?filterViewsByRoleMax=public` will show all public views only,
   - Added styling option for map labels :  outline color.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/62f76547809f342ad8c8a3b9c5f7a5ceba02c3ec" target="_blank">1.5.4</a>
  - Faster and more accurate view count without analyzing sequentially every project. It should counts shared views, external views, private views, public views and targeted views for every project of the current user.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/05bd71f1c4bffa9b07e588a160770cb1c539cb84" target="_blank">1.5.3</a>
  - Added a new sharing option : any view can be imported as external, non-modifiable view in a project where the user is at least a publisher,
  - Removed www/ files from git repo : those are built with webpack, not useful to have them around.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/34674b85a3c1d0b34979b40a5fbca8febc0783bd" target="_blank">1.5.2</a>
  - Fixed story map view selection #255,
  - Fixed raster legend size : let the user click to expand the image into a modal,
  - Fixed legend label alignment,
  - Fixed long abstract #253.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/81596c1b7c6ff64740662067ae41080fccf78788" target="_blank">1.5.1</a>
  - Solved bug where user was not able to authenticate when uploading an image,
  - Better legend and description of view content, using multi-column layout.
- <a href="https://github.com/unep-grid/map-x-mgl/tree/2e8249a3142d5f9be01dfd0e5afd4b414ab336f4" target="_blank">1.5.0</a> 
  - Refactoring,
  - Manage by project. It's now possible to manage your data by project, in addition to collections and classes, 
  - Using docker for the whole stack,
  - Merged app and api under the same repository.
